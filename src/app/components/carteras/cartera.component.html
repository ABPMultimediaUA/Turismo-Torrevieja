<br><br><br><br><br>
<div class="container-fluid">
      <div style="width:100%">
        <h1 style="margin:auto;"><span class="icon-folder-open"></span> Cartera
          <small>{{cartera.nombreCartera}}</small>
          <button *ngIf="!permisoEditar" (click)="puedeEditar()"
          type="button" class="btn btn-outline-success">
            <span class="icon-pencil"></span>Editar
          </button>
        </h1>
      </div>
        <!-- mensajes -->
        <div class="container" *ngIf="errorCartera === true">
            <div class="jumbotron">
                <div class="text-center"><i class="fa fa-5x fa-frown-o" style="color:#d9534f;"></i></div>
                <h1 class="text-center">¡Ups! <p> </p>
                  <p><small class="text-center"> Ha habido un error creando una cartera.</small></p></h1>
                  <p class="text-center text-danger" *ngFor="let mensaje of errorMensaje">
                        {{mensaje}}
                </p>
            </div>
        </div>
        <div class="container" *ngIf="errorCarteraActualizar === true">
            <div class="jumbotron">
                <div class="text-center"><i class="fa fa-5x fa-frown-o" style="color:#d9534f;"></i></div>
                <h1 class="text-center">¡Ups! <p> </p>
                  <p><small class="text-center"> Ha habido un error actualizando una cartera.</small></p></h1>
                  <p class="text-center text-danger" *ngFor="let mensaje of errorMensaje">
                        {{mensaje}}
                </p>
            </div>
        </div>
        <div class="container" *ngIf="rgstrCartera === true">
            <div class="jumbotron">
                <div class="text-center"><i class="fa fa-5x fa-smile-o" style="color:#28a745;"></i></div>
                <h1 class="text-center">¡Cartera creada! <p> </p>
                  <p><small class="text-center text-success"> Se ha enviado un email de confirmación a {{cartera.correo}}.</small></p></h1>

            </div>
        </div>
        <form (ngSubmit)="guardar()" #forma="ngForm">

        <!-- *ngIf="!permisoEditar" -->
          <!-- <div *ngIf="!permisoEditar" class="form-group">
            <label>Nombre</label>
            <input [(ngModel)]="cartera.nombreCartera"
              name="nombreCartera"
              class="form-control"
              placeholder="Nombre de la Cartera"
              readonly
              type="text">
          </div>
          <div *ngIf="!permisoEditar" class="form-group">
            <label>Año</label>
            <input [(ngModel)]="cartera.year"
              name="año"
              class="form-control"
              placeholder="Año de la Cartera"
              readonly
              type="text">
          </div>
          <div *ngIf="!permisoEditar" class="form-group">
            <label>Trimestre</label>
            <input [(ngModel)]="cartera.trimestre"
              name="trimestre"
              class="form-control"
              placeholder="Trimestre de la cartera"
              readonly
              type="text">
          </div>

          <div *ngIf="permisoEditar" class="form-group">
            <label>Nombre</label>
            <input [(ngModel)]="cartera.nombreCartera"
              name="nombreCartera"
              class="form-control"
              placeholder="Nombre de la Cartera"
              required
              type="text">
          </div>
          <div *ngIf="permisoEditar" class="form-group">
            <label>Año</label>
            <input [(ngModel)]="cartera.year"
              name="año"
              class="form-control"
              placeholder="Año de la Cartera"
              required
              type="text">
          </div>

          <div *ngIf="permisoEditar" class="form-group">
                  <label>Trimestre</label>
                  <select [(ngModel)]="cartera.trimestre"
                    name="trimestre"
                    class="form-control">
                      <option value="1">1er Trimestre</option>
                      <option value="2">2do Trimestre</option>
                      <option value="3">3er Trimestre</option>
                      <option value="4">4to Trimestre</option>
                  </select>
          </div> -->

          <div class="row">
          <!-- *ngIf="!permisoEditar" -->
            <div *ngIf="!permisoEditar" class="form-group col-sm-3">
              <label>Nombre</label>
              <input [(ngModel)]="cartera.nombreCartera"
                name="nombreCartera"
                class="form-control"
                placeholder="Nombre de la Cartera"
                readonly
                type="text">
            </div>
            <div *ngIf="!permisoEditar" class="form-group col-sm-3">
              <label>Año</label>
              <input [(ngModel)]="cartera.year"
                name="año"
                class="form-control"
                placeholder="Año de la Cartera"
                readonly
                type="text">
            </div>
            <div *ngIf="!permisoEditar" class="form-group col-sm-3">
              <label>Trimestre</label>
              <input [(ngModel)]="cartera.trimestre"
                name="trimestre"
                class="form-control"
                placeholder="Trimestre de la cartera"
                readonly
                type="text">
            </div>
            <div *ngIf="!permisoEditar" class="form-group col-sm-3">
              <label>Estado</label>
              <input [(ngModel)]="cartera.estado"
                name="estado"
                class="form-control"
                placeholder="Estado de la cartera"
                readonly
                type="text">
            </div>
              <!-- *ngIf="permisoEditar" -->
            <div *ngIf="permisoEditar" class="form-group col-sm-3">
              <label>Nombre</label>
              <input [(ngModel)]="cartera.nombreCartera"
                name="nombreCartera"
                class="form-control"
                placeholder="Nombre de la Cartera"
                required
                type="text">
            </div>
            <div *ngIf="permisoEditar" class="form-group col-sm-3">
              <label>Año</label>
              <input [(ngModel)]="cartera.year"
                name="año"
                class="form-control"
                placeholder="Año de la Cartera"
                required
                type="text">
            </div>
            <div *ngIf="permisoEditar" class="form-group col-sm-3">
              <label>Trimestre</label>
              <input [(ngModel)]="cartera.trimestre"
                name="trimestre"
                class="form-control"
                placeholder="Trimestre de la cartera"
                required
                type="text">
            </div>
            <div *ngIf="permisoEditar" class="form-group col-sm-3">
              <label>Estado</label>
              <input [(ngModel)]="cartera.estado"
                name="estado"
                class="form-control"
                placeholder="Estado de la cartera"
                required
                type="text">
            </div>
        </div>


          <div class="form-group">
            <button *ngIf="permisoEditar"
            [disabled]="!forma.valid"
               type="submit" class="btn btn-outline-primary">
              Guardar cambios
            </button>
            <button *ngIf="permisoEditar"
              [routerLink]="['/carteras']"
               class="btn btn-outline-danger">
              Cancelar
            </button>
            <button *ngIf="!permisoEditar"
              [routerLink]="['/carteras']"
               class="btn btn-outline-danger">
              Atras
            </button>
          </div>
        </form>
        <br>
        <div class="row">
           <h3 class="col-sm-3">Expedientes</h3>
           <button *ngIf="!formExVisible && cartera.estado <3 " (click)="mostrarFormExp(true)" type="button" name="button" class="btn btn-outline-primary">Nuevo expediente</button>
           <button *ngIf="formExVisible" (click)="mostrarFormExp(false)" type="button" name="button" class="btn btn-outline-danger">Cancelar</button>
        </div>
        <br>
        <!-- ***************** FORMULARIO EXPEDIENTE ***************** -->
        <div *ngIf="formExVisible">
          <form (ngSubmit)="crearNuevoExp()" #forma="ngForm">
            <div class="row">
              <div class="col-sm-3">
                <label>Nombre del expediente</label>
                <input [(ngModel)]="expN.nombreExpediente" name=Exp_nomb class="form-control" required type="text">
              </div>
              <div class="col-sm-3">
                <label>Título</label>
                <input [(ngModel)]="expN.titulo" name=Exp_tit class="form-control" type="text">
              </div>
              <div class="col-sm-3">
                <label>Coordinador</label>
                <select class="form-control" name=Exp_user [(ngModel)]="expN.coordinador">
                  <option [ngValue]="u.identificador" *ngFor="let u of users">{{u.nombreUsuario}}</option>
                </select>
              </div>
              <div class="col-sm-3">
                <label>Fecha inicio</label>
                <input [(ngModel)]="expN.fechaInicio" name=Exp_fechaIn class="form-control" type="date">
              </div>
              <div class="col-sm-3">
                <label>Fecha final</label>
                <input [(ngModel)]="expN.fechaFin" name=Exp_fechaFin class="form-control" type="date">
              </div>
              <div class="col-sm-3">
                <button [disabled]="!forma.valid" type="submit" class="btn btn-outline-primary">
                  Crear
                </button>
              </div>
            </div>
          </form>
          <br>
        </div>
        <!-- ***************** LISTA EXPEDIENTES ***************** -->
        <table class="table table-striped">
          <thead class="thead-dark">
            <tr>
              <th scope="col">#</th>
              <th scope="col">Id</th>
              <th scope="col">Nombre</th>
              <th scope="col">Título</th>
              <th scope="col">Coordinador</th>
              <th scope="col">Fecha Inicio</th>
              <th scope="col">Fecha Fin</th>
              <th *ngIf="cartera.estado >=3 " class="text-right">Opciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let e of  expediente; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ e.identificador }}</td>
              <td>{{ e.nombreExpediente }}</td>
              <td>{{ e.titulo }}</td>
              <td>{{ e.coordinador }}</td>
              <td>{{ e.fechaInicio }}</td>
              <td>{{ e.fechaFin }}</td>
              <td class="text-right w20">
                <button *ngIf="cartera.estado >=3 "  [routerLink]="['/expediente', e.identificador]"
                type="button" class="btn btn-outline-success">
                  <span class="icon-pencil"></span>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
